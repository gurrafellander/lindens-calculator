<!DOCTYPE html>
<html lang="sv">

<head>
  <link href='https://fonts.googleapis.com/css?family=Nunito' rel='stylesheet'>
  <style>
    body {
      font-family: 'Nunito';
    }
  </style>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lackningskalkyl</title>

  <!-- CSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json" />
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h2>Lackningskalkyl</h2>
      <p class="muted">
        Fyll antal, mått och tillval. Prislista kan justeras nedan.
      </p>
    </div>

    <!-- 1) Dörrar / luckor / list -->
    <div class="card">
      <h3>Typer</h3>
      <table class="tbl" id="itemsTable" aria-label="Typer">
        <thead>
          <tr>
            <th style="width: 120px">Typ</th>
            <th style="width: 70px">Antal</th>
            <th class="right">Radpris</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Lucka upp till 1000 mm</td>
            <td>
              <input class="input" id="lucka_u1000" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_lucka_u1000">—</td>
          </tr>
          <tr>
            <td>Lucka 1000–1500 mm</td>
            <td>
              <input class="input" id="lucka_1000_1500" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_lucka_1000_1500">—</td>
          </tr>
          <tr>
            <td>Lucka med spegel/urfräsning</td>
            <td>
              <input class="input" id="lucka_spegel" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_lucka_spegel">—</td>
          </tr>
          <tr>
            <td>Skafferidörr / Täcksida</td>
            <td>
              <input class="input" id="skafferidor" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_skafferidor">—</td>
          </tr>
          <tr>
            <td>Garderobsdörr över 1500 mm</td>
            <td>
              <input class="input" id="garderob_o1500" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_garderob_o1500">—</td>
          </tr>
          <tr>
            <td>Lådfront 45-50 cm</td>
            <td>
              <input class="input" id="ladfront_45" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_ladfront_45">—</td>
          </tr>
          <tr>
            <td>Lådfront stor</td>
            <td>
              <input class="input" id="ladfront_stor" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_ladfront_stor">—</td>
          </tr>
          <tr>
            <td>Innerdörr</td>
            <td>
              <input class="input" id="innerdor" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_innerdor">—</td>
          </tr>
          <tr>
            <td>Innerdörr glasad</td>
            <td>
              <input class="input" id="innerdor_glas" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_innerdor_glas">—</td>
          </tr>
          <tr>
            <td>Stol</td>
            <td>
              <input class="input" id="stol" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_stol">—</td>
          </tr>
          <tr>
            <td>Kryddhylla</td>
            <td>
              <input class="input" id="kryddhylla" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_kryddhylla">—</td>
          </tr>
          <tr>
            <td>Bord</td>
            <td>
              <input class="input" id="bord" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_bord">—</td>
          </tr>
          <tr>
            <td>Ytterdörr 1-sida</td>
            <td>
              <input class="input" id="ytterdor_1" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_ytterdor_1">—</td>
          </tr>
          <tr>
            <td>Ytterdörr 2-sidor</td>
            <td>
              <input class="input" id="ytterdor_2" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_ytterdor_2">—</td>
          </tr>
          <tr>
            <td>Karm</td>
            <td>
              <input class="input" id="karm" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_karm">—</td>
          </tr>
          <tr>
            <td>Sidoljus</td>
            <td>
              <input class="input" id="sidoljus" type="number" min="0" step="1" inputmode="numeric" />
            </td>
            <td class="right" id="line_sidoljus">—</td>
          </tr>
          <tr>
            <td>Sockel, krönlist (m)</td>
            <td>
              <input class="input" id="sockel_m" type="number" min="0" step="0.1" inputmode="decimal" />
            </td>
            <td class="right" id="line_sockel_m">—</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 2) Special -->
    <div class="card">
      <h3>Special</h3>
      <table class="tbl" aria-label="Special">
        <thead>
          <tr>
            <th>Egenskap</th>
            <th>Värde</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Typ</td>
            <td>
              <select id="spec_typ" class="select">
                <option value="mobel">Möbel</option>
                <option value="skiva">Skiva</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>Antal</td>
            <td>
              <input class="input" id="spec_antal" type="number" min="0" step="1" inputmode="numeric" />
            </td>
          </tr>
          <tr>
            <td>Bredd (mm)</td>
            <td>
              <input class="input" id="spec_b" type="number" min="0" step="1" inputmode="numeric" />
            </td>
          </tr>
          <tr>
            <td>Djup (mm)</td>
            <td>
              <input class="input" id="spec_d" type="number" min="0" step="1" inputmode="numeric" />
            </td>
          </tr>
          <tr>
            <td>Höjd (mm)</td>
            <td>
              <input class="input" id="spec_h" type="number" min="0" step="1" inputmode="numeric" />
            </td>
          </tr>
          <tr>
            <td>Hyllplan</td>
            <td>
              <input class="input" id="spec_hyll" type="number" min="0" step="1" value="0" inputmode="numeric" />
            </td>
          </tr>
          <tr>
            <td>Utv.</td>
            <td style="text-align: center">
              <input type="checkbox" id="spec_utv" />
            </td>
          </tr>
          <tr>
            <td>Baksida</td>
            <td style="text-align: center">
              <input type="checkbox" id="spec_bak" />
            </td>
          </tr>
          <tr>
            <td>Under</td>
            <td style="text-align: center">
              <input type="checkbox" id="spec_under" />
            </td>
          </tr>
          <tr>
            <td>Invänd.</td>
            <td style="text-align: center">
              <input type="checkbox" id="spec_inv" />
            </td>
          </tr>
          <tr>
            <td>m²</td>
            <td class="right" id="spec_m2">—</td>
          </tr>
          <tr>
            <td>Radpris</td>
            <td class="right" id="spec_sum">—</td>
          </tr>
        </tbody>
      </table>
      <p class="note">
        m²: möbel ≈ bredd × höjd, skiva ≈ bredd × djup. Sidor/tillval ger
        %-påslag.
      </p>
    </div>

    <!-- 3) Arbete + tillägg -->
    <div class="card grid g3">
      <div class="field">
        <label for="besok">Antal besök</label>
        <input id="besok" class="input" type="number" min="0" step="1" value="1" inputmode="numeric" />
      </div>
      <div class="field">
        <label for="rabatt">Rabatt (%)</label>
        <input id="rabatt" class="input" type="number" min="0" max="100" step="0.1" value="0" inputmode="decimal" />
      </div>
      <div class="field">
        <label for="spackling">Spackling</label>
        <input id="spackling" class="input" type="number" min="0" step="1" value="0" inputmode="numeric" />
      </div>
      <div class="field">
        <label for="stallkostnad">Ställkostnad</label>
        <input id="stallkostnad" class="input" type="number" min="0" step="1" value="0" inputmode="numeric" />
      </div>
      <div class="field">
        <label for="vat">Moms (%)</label>
        <select id="vat" class="select">
          <option value="25" selected>25%</option>
          <option value="12">12%</option>
          <option value="6">6%</option>
          <option value="0">0%</option>
        </select>
      </div>
    </div>

    <!-- 4) Summering -->
    <div class="card">
      <div class="result" style="margin-top: 12px" aria-live="polite">
        <h3>Resultat</h3>
        <div class="row" style="justify-content: space-between">
          <span class="muted">Belopp (material + special):</span><strong id="belopp">—</strong>
        </div>
        <div class="row" style="justify-content: space-between">
          <span class="muted">Spackling:</span><strong id="res_spackling">—</strong>
        </div>
        <div class="row" style="justify-content: space-between">
          <span class="muted">Ställkostnad:</span><strong id="res_stallkostnad">—</strong>
        </div>
        <div class="row" style="justify-content: space-between">
          <span class="muted">Rabatt:</span><strong id="res_rabatt">—</strong>
        </div>
        <hr />
        <div class="row" style="justify-content: space-between">
          <span class="muted">Summa:</span><strong id="summa">—</strong>
        </div>
        <div class="row" style="justify-content: space-between">
          <span class="muted">exkl. ROT 30%:</span><strong id="exkl_rot">—</strong>
        </div>
        <div class="row" style="justify-content: space-between">
          <span class="muted">inkl. moms:</span><strong id="inkl_moms">—</strong>
        </div>
      </div>
    </div>

    <div id="prislista-container"></div>


    <!-- JS -->
    <script>
      fetch("prices.html")
        .then(r => r.text())
        .then(html => {
          document.getElementById("prislista-container").innerHTML = html;
        });
    </script>
    <script>
      async function loadPriceDefaults() {
        try {
          const response = await fetch("prices.json");
          const data = await response.json();

          Object.entries(data).forEach(([id, value]) => {
            const input = document.getElementById(id);
            if (input) input.value = value;
            else console.warn("ID saknas i HTML:", id);
          });

        } catch (err) {
          console.error("Kunde inte läsa JSON:", err);
        }
        bindAutoSave();
        compute();
      }

      loadPriceDefaults();

    </script>

    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("./service-worker.js")
          .then(() => console.log("Service Worker registrerad!"))
          .catch(console.error);
      }
    </script>
    <script src="app.js"></script>
</body>

</html>